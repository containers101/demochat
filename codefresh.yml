version: '1.0'
steps:
  build_step:
    title: Build
    type: build
    dockerfile: Dockerfile
    image_name: containers101/demochat
    tag: '${{CF_BRANCH}}'

  deploy_to_kubernetes:
    image: codefresh/cf-deploy-kubernetes
    tag: latest
    working_directory: ${{main_clone}}
    commands:
      - /cf-deploy-kubernetes deployment.yml
    environment:
      - KUBERNETES_USER=${{KUBERNETES_USER}}
      - KUBERNETES_PASSWORD=${{KUBERNETES_PASSWORD}}
      - KUBERNETES_SERVER=${{KUBERNETES_SERVER}}
      - DOCKER_IMAGE_TAG=${{CF_BRANCH}}
    when:
      condition:
        all:
          deploy_to_kubernetes: '"${{DEPLOY_KUBERNETES}}" == "true"'
